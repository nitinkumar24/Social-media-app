
<head>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>SocioGrams</title>

</head>


<main-page>
   <aside>
      <div class="sidepanel">
         <%= render 'sidepanel' %>
      </div>
   </aside>

   <section class="">
      <div class="createPost">
         <%= render 'posts/post_form' %>
      </div>

      <div id="posts">

         <%= render @posts %>

         <%= will_paginate @posts %>
      </div>

      <br>

   </section>

   <ads>



          <div class="ui half page test ad">
             <p>New to SocioGrams</p>

             <div class="ui feed divider new_users">
                <% @new_users.each do |user| %>
                <div class="event">
                   <div class="label">
                      <%= image_tag user.avatar.url(:medium) %>
                   </div>
                   <div class="content">
                      <div class="summary">
                         <a class="user">
                            <%= render 'profile/profile_link' ,user: user %>
                         </a>@<%= user.username %>

                      </div>
                      <div class="meta">
                         <a class="like">
                       <span>
                   <% if current_user.can_follow user.id %>
                       <%= link_to "Follow", url_for(controller: :friendrequests, action: :toggle_follow_request, followee_id: user.id), method: :post, id:"user_#{user.id}",remote: true %>
                   <% end %>

                          <% if current_user.can_delete_request user.id %>
                       <%= link_to "Requested", url_for(controller: :friendrequests, action: :toggle_follow_request, followee_id: user.id), method: :post ,id:"user_#{user.id}", remote: true  %>
                   <% end %>

                          <% if current_user.can_un_follow user.id %>
                       <%= link_to "unfollow", url_for(controller: :friendrequests, action: :toggle_follow_request, followee_id: user.id), method: :post,id:"user_#{user.id}", remote: true  %>
                   <% end %>

      </span>
                         </a>
                      </div>
                   </div>
                </div>
                <% end %>
             </div>
          </div>

   </ads>

   <chatbox>
   </chatbox>

</main-page>

<script>


    //    $.ajax({url: '/ajax',
    //        data: {
    //            mode: sessionStorage.getItem('mode')
    //        }
    //        , success: function(data){
    //            console.log(data);
    //            console.log("request completed");
    //
    //        },
    //        error: function(){
    //            console.log(arguments);
    //            console.log("some error");
    //        }
    //    });


    //image preview before upload
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#blah').attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
            $(".dup-pic").css("display","block");
            $('#post_anonymous').attr('checked', false); // Unchecks it
            $("#post_anonymous").attr("disabled", true);

        }
    }


    $("#imgInp").change(function(){
        readURL(this);
    });
    //End-image preview before upload

    $(".cancel-pic").click(function () {
        $("#imgInp").val('');
        $(".dup-pic").css("display","none");
        $("#post_anonymous").attr("disabled", false);
        console.log("hi");

    });

</script>
